<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­</title>
  <meta name="description" content="è³ªå•ã«ç­”ãˆã‚‹ã ã‘ã§ã€ã‚ãªãŸã‚’è¡¨ã™ã€Œ12ã‚¿ã‚¤ãƒ—å‹•ç‰©ã‚­ãƒ£ãƒ©ã€ãŒã‚ã‹ã‚‹è¨ºæ–­ã€‚æ€§æ ¼ãƒ»ä»•äº‹ãƒ»æ‹æ„›ã®å‚¾å‘ã«åŠ ãˆã¦ã€ç›¸æ€§è¨ºæ–­ã‚„çµæœã‚«ãƒ¼ãƒ‰ã®ä¿å­˜ã‚‚ã§ãã¾ã™ã€‚">
  <link rel="canonical" href="https://kajisananimal.github.io/nyan/compatibility.html">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;900&family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" type="image/png" href="assets/favicon-32.png">
  <link rel="apple-touch-icon" href="assets/icon-192.png">



<script type="application/ld+json">{"@context": "https://schema.org", "@type": "WebSite", "name": "ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­", "description": "è³ªå•ã«ç­”ãˆã‚‹ã ã‘ã§ã€ã‚ãªãŸã‚’è¡¨ã™ã€Œ12ã‚¿ã‚¤ãƒ—å‹•ç‰©ã‚­ãƒ£ãƒ©ã€ãŒã‚ã‹ã‚‹è¨ºæ–­ã€‚æ€§æ ¼ãƒ»ä»•äº‹ãƒ»æ‹æ„›ã®å‚¾å‘ã«åŠ ãˆã¦ã€ç›¸æ€§è¨ºæ–­ã‚„çµæœã‚«ãƒ¼ãƒ‰ã®ä¿å­˜ã‚‚ã§ãã¾ã™ã€‚", "inLanguage": "ja", "url": "./"}</script>

    <!-- Open Graph / Twitter (for LINE, SNS share preview) -->




    <!-- Open Graph / Twitter (for LINE, SNS share preview) -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­">
    <meta property="og:description" content="è³ªå•ã«ç­”ãˆã‚‹ã ã‘ã§ã€ã‚ãªãŸã‚’è¡¨ã™ã€12ã‚¿ã‚¤ãƒ—å‹•ç‰©ã‚­ãƒ£ãƒ©ã€ãŒã‚ã‹ã‚‹è¨ºæ–­ã€‚çµæœã¯ã‚·ã‚§ã‚¢ï¼†ç›¸æ€§è¨ºæ–­ã‚‚ã§ãã‚‹ã‚ˆã€‚">
    <meta property="og:image" content="https://kajisananimal.github.io/nyan/assets/ogp_line.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­">
    <meta name="twitter:description" content="è³ªå•ã«ç­”ãˆã‚‹ã ã‘ã§ã€ã‚ãªãŸã‚’è¡¨ã™ã€12ã‚¿ã‚¤ãƒ—å‹•ç‰©ã‚­ãƒ£ãƒ©ã€ãŒã‚ã‹ã‚‹è¨ºæ–­ã€‚çµæœã¯ã‚·ã‚§ã‚¢ï¼†ç›¸æ€§è¨ºæ–­ã‚‚ã§ãã‚‹ã‚ˆã€‚">
    <meta name="twitter:image" content="https://kajisananimal.github.io/nyan/assets/ogp_line.png">
    
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="badge">ç›¸</div>
        <div>
          <h1>ç›¸æ€§ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­</h1>
          <div class="subtitle">2äººã®ã‚¿ã‚¤ãƒ—ã‚’é¸ã¶ã ã‘</div>
        </div>
      </div>
      <nav class="nav">
        <a href="index.html">ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­</a>
        <a href="compatibility.html">ç›¸æ€§</a>
      </nav>
    </header>

    <section class="card">
      <div class="compat-grid">
        <div>
          <h2 style="margin:0 0 10px;">ã‚ãªãŸ</h2>
          <select id="me"></select>
          <div class="result-wrap" style="margin-top:12px;">
            <img id="meImg" src="" alt="ã‚ãªãŸã®ç”»åƒ" />
            <div>
              <div class="type-pill" id="meLabel"></div>
              <div class="small" id="meCatch"></div>
            </div>
          </div>
        </div>

        <div>
          <h2 style="margin:0 0 10px;">ç›¸æ‰‹</h2>
          <select id="you"></select>
          <div class="result-wrap" style="margin-top:12px;">
            <img id="youImg" src="" alt="ç›¸æ‰‹ã®ç”»åƒ" />
            <div>
              <div class="type-pill" id="youLabel"></div>
              <div class="small" id="youCatch"></div>
            </div>
          </div>
        </div>
      </div>

      <hr class="sep" />

      <div class="card" style="padding:14px;">
        <h2 style="margin:0 0 8px;">ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­çµæœ</h2>
        <div style="display:flex; gap:12px; flex-wrap:wrap; align-items:center;">
          <div class="type-pill" id="grade"></div>
          <div class="stars" id="stars"></div>
          <div class="small" id="msg"></div>
        </div>
        <div class="actions" style="margin-top:12px;">
          <button class="primary" id="btnSaveCompat">ç›¸æ€§ã‚«ãƒ¼ãƒ‰ã‚’ä¿å­˜</button>
          <button class="secondary" id="btnCopy">ç›¸æ€§URLã‚’ã‚³ãƒ”ãƒ¼</button>
          <a class="btn secondary" id="btnShare" target="_blank" rel="noopener">Xã§ã‚·ã‚§ã‚¢</a>
          <a class="btn ghost" href="index.html">ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­ã¸æˆ»ã‚‹</a>
        </div>
        <div class="footer" id="urlLine"></div>
      </div>
    </section>
  </div>

<script src="app.js"></script>
<script>
  const selMe = document.getElementById("me");
  const selYou = document.getElementById("you");

  function addOptions(sel){
    sel.innerHTML = "";
    Object.entries(TYPES).forEach(([key, t])=>{
      const o = document.createElement("option");
      o.value = key;
      o.textContent = t.label;
      sel.appendChild(o);
    });
  }
  addOptions(selMe); addOptions(selYou);

  const q = parseQuery();
  if (q.me && TYPES[q.me]) selMe.value = q.me;
  if (q.you && TYPES[q.you]) selYou.value = q.you;

  function render(){
    const me = TYPES[selMe.value];
    const you = TYPES[selYou.value];

    document.getElementById("meImg").src = me.img;
    document.getElementById("meLabel").textContent = me.label;
    document.getElementById("meCatch").textContent = me.catch;

    document.getElementById("youImg").src = you.img;
    document.getElementById("youLabel").textContent = you.label;
    document.getElementById("youCatch").textContent = you.catch;

    const r = prettyCompatibility(me.key, you.key);
    document.getElementById("grade").textContent = `ğŸ’– ç›¸æ€§ï¼š${r.percent}%`;
    document.getElementById("stars").textContent = r.stars;
    document.getElementById("msg").textContent = r.msg;

    const url = `${baseUrl()}/compatibility.html?me=${encodeURIComponent(me.key)}&you=${encodeURIComponent(you.key)}`;
    document.getElementById("urlLine").textContent = url;

    document.getElementById("btnCopy").onclick = async ()=>{
      await copyText(url);
      document.getElementById("btnCopy").textContent = "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼";
      setTimeout(()=>document.getElementById("btnCopy").textContent="ç›¸æ€§URLã‚’ã‚³ãƒ”ãƒ¼", 1200);
    };

    const shareText = `ç›¸æ€§ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­ï¼š${me.label} Ã— ${you.label}\nçµæœï¼š${r.grade}ï¼ˆ${r.msg}ï¼‰\nğŸ‘‡ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­ã¯ã“ã¡ã‚‰`;
    document.getElementById("btnShare").href =
      `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(baseUrl()+"/index.html")}`;

    // update url without reload
    const newUrl = `?me=${encodeURIComponent(me.key)}&you=${encodeURIComponent(you.key)}`;
    history.replaceState(null, "", newUrl);
  }



  function wrapText(ctx, text, x, y, maxWidth, lineHeight){
    const chars = text.split("");
    let line = "";
    for (let i=0;i<chars.length;i++){
      const test = line + chars[i];
      if (ctx.measureText(test).width > maxWidth && line !== ""){
        ctx.fillText(line, x, y);
        line = chars[i];
        y += lineHeight;
      } else {
        line = test;
      }
    }
    if (line) ctx.fillText(line, x, y);
    return y;
  }

  async function saveCompatCardAsImage(){
    const meKey = selMe.value;
    const youKey = selYou.value;
    const me = TYPES[meKey];
    const you = TYPES[youKey];
    const r = prettyCompatibility(me.key, you.key);

    const W = 1080, H = 1350;
    const canvas = document.createElement('canvas');
    canvas.width = W; canvas.height = H;
    const ctx = canvas.getContext('2d');

    // background
    const g = ctx.createLinearGradient(0,0,W,H);
    g.addColorStop(0,'#fff0f8');
    g.addColorStop(1,'#eef6ff');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,W,H);

    // card
    ctx.fillStyle = 'rgba(255,255,255,0.92)';
    roundRect(ctx, 60, 60, W-120, H-120, 44);
    ctx.fill();

    // title
    ctx.fillStyle = '#3a2b57';
    ctx.font = '700 54px "M PLUS Rounded 1c", system-ui';
    ctx.fillText('ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­', 100, 150);

    ctx.font = '900 70px "M PLUS Rounded 1c", system-ui';
    ctx.fillStyle = '#ff4fa0';
    ctx.fillText(`ç›¸æ€§ï¼š${r.percent}%`, 100, 240);

    ctx.font = '700 50px "M PLUS Rounded 1c", system-ui';
    ctx.fillStyle = '#5b4a78';
    ctx.fillText(r.stars, 100, 305);

    // icons
    const iconSize = 300;
    const yIcon = 360;
    const x1 = 170, x2 = W - 170 - iconSize;

    const loadImg = (src)=> new Promise((res, rej)=>{ const im = new Image(); im.crossOrigin='anonymous'; im.onload=()=>res(im); im.onerror=rej; im.src=src; });
    const [im1, im2] = await Promise.all([loadImg(me.img), loadImg(you.img)]);

    // frame + clip
    ctx.fillStyle='rgba(255,255,255,0.95)';
    roundRect(ctx, x1-16, yIcon-16, iconSize+32, iconSize+32, 64);
    ctx.fill();
    ctx.save();
    roundRect(ctx, x1, yIcon, iconSize, iconSize, 56);
    ctx.clip();
    ctx.drawImage(im1, x1, yIcon, iconSize, iconSize);
    ctx.restore();

    ctx.fillStyle='rgba(255,255,255,0.95)';
    roundRect(ctx, x2-16, yIcon-16, iconSize+32, iconSize+32, 64);
    ctx.fill();
    ctx.save();
    roundRect(ctx, x2, yIcon, iconSize, iconSize, 56);
    ctx.clip();
    ctx.drawImage(im2, x2, yIcon, iconSize, iconSize);
    ctx.restore();

    // labels
    ctx.fillStyle = '#3a2b57';
    ctx.font = '800 44px "M PLUS Rounded 1c", system-ui';
    ctx.fillText(me.label, x1, yIcon + iconSize + 70);
    ctx.fillText(you.label, x2, yIcon + iconSize + 70);

    // message
    ctx.fillStyle = '#2b2240';
    ctx.font = '700 40px "Zen Maru Gothic", system-ui';
    const textX = 100;
    let y = 880;
    y = wrapText(ctx, r.msg, textX, y, W-200, 58);

    // footer
    ctx.fillStyle = '#6f5a94';
    ctx.font = '700 32px "Zen Maru Gothic", system-ui';
    ctx.fillText(baseUrl() + '/index.html', 100, H-140);

    // Create image blob
    const blob = await new Promise(res=>canvas.toBlob(res, 'image/png'));
    if (!blob){
      const dataUrl = canvas.toDataURL('image/png');
      const w = window.open();
      if (w) w.document.write(`<img src="${dataUrl}" style="max-width:100%;height:auto" />`);
      return;
    }

    // Try native share (iOS: "å†™çœŸã«è¿½åŠ " etc.)
    const file = new File([blob], `12typeQA_compat_${me.key}_${you.key}.png`, { type: "image/png" });
    if (navigator.share && (!navigator.canShare || navigator.canShare({ files: [file] }))) {
      try{
        await navigator.share({ title:"ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­", text:"ç›¸æ€§ã‚«ãƒ¼ãƒ‰ã‚’ä¿å­˜ã—ã¦ã­ï¼", files:[file] });
        return;
      }catch(e){
        // fallback below
      }
    }

    // Fallback: open image (iOS long-press save) / download
    const url = URL.createObjectURL(blob);

    const w = window.open(url, '_blank');
    // cleanup later
    setTimeout(()=>URL.revokeObjectURL(url), 60_000);
    if (!w){
      // fallback download
      const a = document.createElement('a');
      a.href = url;
      a.download = 'compatibility.png';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }
  }
  const btn = document.getElementById("btnSaveCompat");
  if (btn){
    btn.onclick = async ()=>{
      const old = btn.textContent;
      btn.textContent = 'ä½œæˆä¸­â€¦';
      btn.disabled = true;
      try{ await saveCompatCardAsImage(); }
      finally{ btn.disabled = false; btn.textContent = old; }
    };
  }

  selMe.addEventListener("change", render);
  selYou.addEventListener("change", render);
  render();
</script>

</body>
</html>
