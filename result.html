<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­</title>
  <meta name="description" content="è³ªå•ã«ç­”ãˆã‚‹ã ã‘ã§ã€ã‚ãªãŸã‚’è¡¨ã™ã€Œ12ã‚¿ã‚¤ãƒ—å‹•ç‰©ã‚­ãƒ£ãƒ©ã€ãŒã‚ã‹ã‚‹è¨ºæ–­ã€‚æ€§æ ¼ãƒ»ä»•äº‹ãƒ»æ‹æ„›ã®å‚¾å‘ã«åŠ ãˆã¦ã€ç›¸æ€§è¨ºæ–­ã‚„çµæœã‚«ãƒ¼ãƒ‰ã®ä¿å­˜ã‚‚ã§ãã¾ã™ã€‚">
  <link rel="canonical" href="https://kajisananimal.github.io/nyan/result.html">
  <meta name="robots" content="noarchive" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;900&family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/html2canvas.4.1/dist/html2canvas.min.js"></script>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" type="image/png" href="assets/favicon-32.png">
  <link rel="apple-touch-icon" href="assets/icon-192.png">



<script type="application/ld+json">{"@context": "https://schema.org", "@type": "WebSite", "name": "ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­", "description": "è³ªå•ã«ç­”ãˆã‚‹ã ã‘ã§ã€ã‚ãªãŸã‚’è¡¨ã™ã€Œ12ã‚¿ã‚¤ãƒ—å‹•ç‰©ã‚­ãƒ£ãƒ©ã€ãŒã‚ã‹ã‚‹è¨ºæ–­ã€‚æ€§æ ¼ãƒ»ä»•äº‹ãƒ»æ‹æ„›ã®å‚¾å‘ã«åŠ ãˆã¦ã€ç›¸æ€§è¨ºæ–­ã‚„çµæœã‚«ãƒ¼ãƒ‰ã®ä¿å­˜ã‚‚ã§ãã¾ã™ã€‚", "inLanguage": "ja", "url": "./"}</script>

    <!-- Open Graph / Twitter (for LINE, SNS share preview) -->




    <!-- Open Graph / Twitter (for LINE, SNS share preview) -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­">
    <meta property="og:description" content="è³ªå•ã«ç­”ãˆã‚‹ã ã‘ã§ã€ã‚ãªãŸã‚’è¡¨ã™ã€12ã‚¿ã‚¤ãƒ—å‹•ç‰©ã‚­ãƒ£ãƒ©ã€ãŒã‚ã‹ã‚‹è¨ºæ–­ã€‚çµæœã¯ã‚·ã‚§ã‚¢ï¼†ç›¸æ€§è¨ºæ–­ã‚‚ã§ãã‚‹ã‚ˆã€‚">
    <meta property="og:image" content="https://kajisananimal.github.io/nyan/assets/ogp_line.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­">
    <meta name="twitter:description" content="è³ªå•ã«ç­”ãˆã‚‹ã ã‘ã§ã€ã‚ãªãŸã‚’è¡¨ã™ã€12ã‚¿ã‚¤ãƒ—å‹•ç‰©ã‚­ãƒ£ãƒ©ã€ãŒã‚ã‹ã‚‹è¨ºæ–­ã€‚çµæœã¯ã‚·ã‚§ã‚¢ï¼†ç›¸æ€§è¨ºæ–­ã‚‚ã§ãã‚‹ã‚ˆã€‚">
    <meta name="twitter:image" content="https://kajisananimal.github.io/nyan/assets/ogp_line.png">
    
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="badge">çµ</div>
        <div>
          <h1>ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­çµæœ</h1>
          <div class="subtitle">çµæœURLã‚’ãã®ã¾ã¾å…±æœ‰ã§ãã¾ã™</div>
        </div>
      </div>
      <nav class="nav">
        <a href="index.html">ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­</a>
        <a href="compatibility.html">ç›¸æ€§</a>
      </nav>
    </header>

    <section class="card" id="resultCard">
      <div class="result-wrap">
        <img id="typeImg" src="" alt="ã‚¿ã‚¤ãƒ—ç”»åƒ" />
        <div style="flex:1;">
          <div class="result-title">
            <div class="type-pill" id="typeLabel"></div>
            <div class="small" id="typeCatch"></div>
          </div>
          <div class="actions" style="margin-top:12px;">
            <button class="primary" id="btnCopy">çµæœURLã‚’ã‚³ãƒ”ãƒ¼</button>
            <button class="secondary" id="btnSave">ã‚«ãƒ¼ãƒ‰ã‚’ä¿å­˜ï¼ˆã‚¢ãƒ«ãƒãƒ ã¸ï¼‰ âœ¨</button>
            <a class="btn secondary" id="btnX" target="_blank" rel="noopener">Xã§ã‚·ã‚§ã‚¢</a>
            <a class="btn ghost" href="index.html">ã‚‚ã†ä¸€å›ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­</a>
          </div>
          <div class="footer" id="urlLine"></div>
        </div>
      </div>

      <hr class="sep" />

      <div class="compat-grid">
        <div class="card" style="padding:14px;">
          <h2 style="margin:0 0 8px;">åŸºæœ¬æ€§æ ¼</h2>
          <ul id="listPersonality" style="margin:0; padding-left:18px; color:var(--text); line-height:1.7;"></ul>
        </div>

        <div class="card" style="padding:14px;">
          <h2 style="margin:0 0 8px;">ä»•äº‹</h2>
          <ul id="listWork" style="margin:0; padding-left:18px; color:var(--text); line-height:1.7;"></ul>
        </div>

        <div class="card" style="padding:14px;">
          <h2 style="margin:0 0 8px;">æ‹æ„›</h2>
          <ul id="listLove" style="margin:0; padding-left:18px; color:var(--text); line-height:1.7;"></ul>
        </div>

        <div class="card" style="padding:14px;">
          <h2 style="margin:0 0 8px;">ç›¸æ€§ã®ã„ã„ã‚¿ã‚¤ãƒ—</h2>
          <div id="bestWrap" class="small"></div>
          <div class="actions" style="margin-top:12px;">
            <a class="btn secondary" id="btnCompat">ç›¸æ€§ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­ã§ç¢ºèª</a>
          </div>
        </div>
      </div>
    </section>

    <div class="footer">â€»çµæœã¯URLã® <span class="code">type</span> ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã ã‘ã§è¡¨ç¤ºã•ã‚Œã¾ã™ï¼ˆå€‹äººæƒ…å ±ã¯æ‰±ã„ã¾ã›ã‚“ï¼‰ã€‚</div>
  </div>

<script src="app.js"></script>
<script>
  const q = parseQuery();
  const typeKey = (q.type && TYPES[q.type]) ? q.type : "moon_cat";
  const t = TYPES[typeKey];

  document.getElementById("typeImg").src = t.img;
  document.getElementById("typeLabel").textContent = t.label;
  document.getElementById("typeCatch").textContent = t.catch;

  function fillList(id, items){
    const ul = document.getElementById(id);
    ul.innerHTML = "";
    items.forEach(s=>{
      const li = document.createElement("li");
      li.textContent = s;
      ul.appendChild(li);
    });
  }
  fillList("listPersonality", t.personality);
  fillList("listWork", t.work);
  fillList("listLove", t.love);

  const bestWrap = document.getElementById("bestWrap");
  bestWrap.innerHTML = t.best.map(k=>`ãƒ»${TYPES[k].label}`).join("<br/>");

  const url = location.href;
  document.getElementById("urlLine").textContent = url;

  document.getElementById("btnCopy").addEventListener("click", async ()=>{
    await copyText(url);
    document.getElementById("btnCopy").textContent = "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼";
    setTimeout(()=>document.getElementById("btnCopy").textContent="çµæœURLã‚’ã‚³ãƒ”ãƒ¼", 1200);
  });

  const shareText = `ç§ã¯ã€${t.label}ã€‘ã§ã—ãŸï¼\n${t.catch}\nã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­ã¯ã“ã¡ã‚‰ğŸ‘‡`;
  const xUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(url.replace(/result\.html.*/, "index.html"))}`;
  document.getElementById("btnX").href = xUrl;

  document.getElementById("btnCompat").href = `compatibility.html?me=${encodeURIComponent(typeKey)}`;

  async function saveCardAsImage(){
    // Wait for webfonts (helps iOS/Android render text reliably before canvas export)
    try{ if (document.fonts && document.fonts.ready) await document.fonts.ready; } catch(e) {}

    // Build a 1080x1080 shareable card
    const size = 1080;
    const canvas = document.createElement("canvas");
    canvas.width = size; canvas.height = size;
    const ctx = canvas.getContext("2d");

    // Background (yume-kawa retro)
    const g = ctx.createLinearGradient(0,0,size,size);
    g.addColorStop(0, "rgba(255,159,214,0.95)");
    g.addColorStop(0.5, "rgba(183,166,255,0.92)");
    g.addColorStop(1, "rgba(142,231,255,0.90)");
    ctx.fillStyle = g;
    ctx.fillRect(0,0,size,size);

    // Soft paper grain
    ctx.globalAlpha = 0.10;
    for (let i=0;i<1400;i++){
      const x = Math.random()*size;
      const y = Math.random()*size;
      const r = Math.random()*1.2;
      ctx.fillStyle = "rgba(255,255,255,1)";
      ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();
    }
    ctx.globalAlpha = 0.20;

    // Retro dots
    const step = 18;
    ctx.fillStyle = "rgba(255,255,255,0.35)";
    for (let y=10;y<size;y+=step){
      for (let x=10;x<size;x+=step){
        ctx.beginPath(); ctx.arc(x,y,1.2,0,Math.PI*2); ctx.fill();
      }
    }
    ctx.globalAlpha = 1;
    ctx.fillStyle = g;
    ctx.fillRect(0,0,size,size);

    // Frame
    const pad = 44;
    ctx.fillStyle = "rgba(0,0,0,0.35)";
    ctx.fillRect(pad, pad, size-pad*2, size-pad*2);

    ctx.strokeStyle = "rgba(255,255,255,0.55)";
    ctx.lineWidth = 8;
    ctx.strokeRect(pad, pad, size-pad*2, size-pad*2);

    // Title ribbon
    ctx.fillStyle = "rgba(255,204,0,0.92)";
    ctx.fillRect(pad, pad, size-pad*2, 120);
    ctx.fillStyle = "#1a1200";
    ctx.font = "900 58px 'Noto Sans JP', system-ui, sans-serif";
    ctx.textBaseline = "middle";
    ctx.fillText("ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­", pad+26, pad+60);

    // Character image (square)
    const img = new Image();
    // Avoid "tainted canvas" issues on some in-app browsers
    img.crossOrigin = "anonymous";
    img.src = t.img;
    await new Promise((ok, ng)=>{ img.onload=ok; img.onerror=ng; });

    const imgSize = 560;
    const imgX = (size - imgSize)/2;
    const imgY = pad + 150;
    // image frame
    ctx.fillStyle = "rgba(255,255,255,0.08)";
    ctx.fillRect(imgX-10, imgY-10, imgSize+20, imgSize+20);
    ctx.drawImage(img, imgX, imgY, imgSize, imgSize);

    // Type label
    ctx.fillStyle = "rgba(255,255,255,0.92)";
    ctx.font = "900 56px 'Noto Sans JP', system-ui, sans-serif";
    const label = t.label;
    const textY = imgY + imgSize + 110;
    ctx.textAlign = "center";
    ctx.fillText(label, size/2, textY);

    // Catch copy (wrap)
    ctx.fillStyle = "rgba(238,242,255,0.92)";
    ctx.font = "800 38px 'Noto Sans JP', system-ui, sans-serif";
    const catchText = t.catch;
    const maxWidth = size - pad*2 - 80;
    const words = catchText.split("");
    let line = "";
    let lines = [];
    for (const ch of words){
      const test = line + ch;
      if (ctx.measureText(test).width > maxWidth){
        lines.push(line);
        line = ch;
      } else {
        line = test;
      }
    }
    if (line) lines.push(line);
    const startY = textY + 74;
    lines = lines.slice(0,2);
    lines.forEach((ln,i)=>{
      ctx.fillText(ln, size/2, startY + i*50);
    });


    // Summary (80-100 chars)
    const summary = (t.cardSummary || "").trim();
    if (summary){
      ctx.save();
      ctx.globalAlpha = 0.95;
      ctx.font = '700 36px "M PLUS Rounded 1c","Zen Maru Gothic",sans-serif';
      ctx.fillStyle = "rgba(35,26,58,0.90)";
      ctx.textAlign = "left";
      const maxW2 = size - pad*2;
      const sumLines = wrapText(summary, maxW2, ctx).slice(0,3);
      const y0 = size - pad - 120;
      const lh2 = 44;
      sumLines.forEach((ln,i)=>ctx.fillText(ln, pad, y0 + i*lh2));
      ctx.restore();
    }

    // Brand mark
    ctx.save();
    ctx.globalAlpha = 0.92;
    ctx.font = '900 44px "M PLUS Rounded 1c","Zen Maru Gothic",sans-serif';
    ctx.textAlign = "right";
    ctx.fillStyle = "rgba(255,255,255,0.92)";
    ctx.fillText("ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­", size - pad, size - pad);
    ctx.restore();

    // Share Sheet (iOS/Android) -> ã€Œå†™çœŸã«ä¿å­˜ã€ã§ã‚¢ãƒ«ãƒãƒ ã¸
    const blob = await new Promise(resolve=>canvas.toBlob(resolve, "image/png"));
    if (!blob) {
      // Safari fallback
      const a0 = document.createElement("a");
      a0.download = `12typeQA_${typeKey}.png`;
      a0.href = canvas.toDataURL("image/png");
      a0.click();
      return;
    }
    const file = new File([blob], `12typeQA_${typeKey}.png`, { type: "image/png" });

    if (navigator.share && (!navigator.canShare || navigator.canShare({ files: [file] }))) {
      try{
        await navigator.share({ title:"ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­", text:"çµæœã‚«ãƒ¼ãƒ‰ã‚’ä¿å­˜ã—ã¦ã­ï¼", files:[file] });
        return;
      }catch(e){
        // fallback below
      }
    }

    // Fallback: download / open image (iOS friendly)
    const dataUrl = canvas.toDataURL("image/png");
    const isIOS = /iP(hone|od|ad)/.test(navigator.userAgent);

    // iOS Safari doesn't reliably honor the download attribute.
    // Open the image in a new tab so the user can long-press and save to Photos.
    if (isIOS) {
      const w = window.open("");
      if (w) {
        w.document.write('<meta name="viewport" content="width=device-width, initial-scale=1">');
        w.document.write('<title>ã©ã†ã¶ã¤12ã‚¿ã‚¤ãƒ—è¨ºæ–­</title>');
        w.document.write('<div style="font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif;padding:12px;line-height:1.4;">');
        w.document.write('<div style="font-weight:700;margin-bottom:6px;">çµæœã‚«ãƒ¼ãƒ‰ã‚’ä¿å­˜</div>');
        w.document.write('<div style="font-size:14px;opacity:.8;margin-bottom:10px;">ç”»åƒã‚’<strong>é•·æŠ¼ã—</strong>ã—ã¦ã€Œå†™çœŸã«ä¿å­˜ã€ã‚’é¸ã‚“ã§ã­ã€‚</div>');
        w.document.write('</div>');
        w.document.write(`<img src="${dataUrl}" style="width:100%;height:auto;display:block;">`);
        w.document.close();
      } else {
        // Popup blocked: navigate to image
        window.location.href = dataUrl;
      }
      return;
    }

    const a = document.createElement("a");
    a.download = `12typeQA_${typeKey}.png`;
    a.href = dataUrl;
    document.body.appendChild(a);
    a.click();
    a.remove();
}

  document.getElementById("btnSave").addEventListener("click", async ()=>{
    const btn = document.getElementById("btnSave");
    const prev = btn.textContent;
    btn.textContent = "ä½œæˆä¸­...";
    btn.disabled = true;
    try{
      await saveCardAsImage();
    } finally {
      btn.disabled = false;
      btn.textContent = prev;
    }
  });
</script>
</body>
</html>
